<!doctype html>
<html lang="ar" dir="rtl">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>الخطوة 2 — مواجهة صورتين بالتسلسل</title>
<style>
  html,body{height:100%;margin:0;background:#0b1224;color:#e5e7eb;font:16px/1.6 system-ui,-apple-system,Segoe UI,Roboto,Arial}
  .wrap{max-width:1100px;margin:0 auto;padding:16px}
  h1{font-size:20px;margin:0 0 12px}
  .card{background:#0e142a;border:1px solid #2b3453;border-radius:16px;padding:14px}
  .muted{color:#9aa4bf;font-size:14px;margin-bottom:10px}
  .pair{display:grid;gap:12px;margin-top:10px}
  @media(min-width:820px){ .pair{grid-template-columns:1fr 1fr} }
  .choice{
    border:2px solid #2b3453;background:#101736;border-radius:14px;padding:14px;cursor:pointer;
    transition:border-color .2s ease, box-shadow .2s ease, transform .08s ease
  }
  .choice:hover{border-color:#22c55e;box-shadow:0 0 0 3px rgba(34,197,94,.18) inset;transform:translateY(-2px)}
  .img{width:140px;height:140px;object-fit:contain;display:block;margin:6px auto;border-radius:12px;background:#0b1324;border:1px solid #2b3453;padding:10px}
  .fallback{width:140px;height:140px;display:grid;place-items:center;margin:6px auto;border-radius:12px;background:#0b1324;border:1px solid #2b3453;padding:10px;font-size:46px}
  .title{text-align:center;font-weight:800;margin-top:6px}
  .row{display:flex;gap:10px;flex-wrap:wrap;align-items:center;margin-top:12px}
  .btn{border:1px solid #2b3453;background:#0f1b34;color:#e5e7eb;border-radius:12px;padding:10px 14px;cursor:pointer;text-decoration:none;display:inline-block}
  .btn.primary{background:#22c55e;color:#052e16;border-color:transparent}
  .btn:disabled{opacity:.6;cursor:not-allowed}
  .progress{height:10px;background:#1a2444;border-radius:999px;overflow:hidden;margin:10px 0 6px}
  .bar{height:100%;width:0;background:#22c55e}
</style>
</head>
<body>
  <div class="wrap">
    <div class="card">
      <h1>🖼️ الخطوة 2 — اختاري واحدة في كل جولة</h1>
      <div class="muted">الترتيب: TikTok ضد سناب → الفائزة ضد Instagram → ضد X → ضد إحسان → ضد ChatGPT.</div>

      <div class="progress"><div id="bar" class="bar"></div></div>
      <div id="roundLabel" class="muted">الجولة 1</div>

      <div id="pair" class="pair" aria-live="polite"></div>

      <div class="row">
        <a class="btn" href="./step1-game.html">← السابق</a>
        <button id="nextBtn" class="btn primary" disabled>التالي → لعبة 2</button>
      </div>
    </div>
  </div>

<script>
/* ============ مصادر صور + بدائل ============ */
const ITEMS = [
  { id:"tiktok",   name:"TikTok",
    srcs:[
      "https://logo.clearbit.com/tiktok.com",
      "https://upload.wikimedia.org/wikipedia/commons/3/3a/TikTok_Icon_Black.svg",
      "https://upload.wikimedia.org/wikipedia/commons/a/a9/TikTok_logo.svg"
    ], emoji:"🎵"
  },
  { id:"snapchat", name:"سناب شات",
    srcs:[
      /* رابطك الموثق أولاً */
      "https://geeknewscentral.com/wp-content/uploads/2020/11/Snapchat-logo-2020.png",
      /* بدائل احتياطية */
      "https://logo.clearbit.com/snapchat.com",
      "https://upload.wikimedia.org/wikipedia/commons/c/c4/Snapchat_logo.svg",
      "https://upload.wikimedia.org/wikipedia/commons/thumb/c/c4/Snapchat_logo.svg/512px-Snapchat_logo.svg.png"
    ], emoji:"⚡"
  },
  { id:"instagram", name:"Instagram",
    srcs:[
      "https://logo.clearbit.com/instagram.com",
      "https://upload.wikimedia.org/wikipedia/commons/a/a5/Instagram_icon.png"
    ], emoji:"📸"
  },
  { id:"twitterx", name:"Twitter (X)",
    srcs:[
      "https://logo.clearbit.com/x.com",
      "https://upload.wikimedia.org/wikipedia/commons/9/95/Twitter_new_X_logo.png",
      "https://upload.wikimedia.org/wikipedia/commons/5/53/X_logo_2023_original.svg"
    ], emoji:"🐦"
  },
  { id:"ihsan", name:"إحسان",
    srcs:[
      /* رابطك الموثق أولاً */
      "https://www.okaz.com.sa/uploads/images/2022/08/26/2018065.jpg",
      /* بدائل احتياطية */
      "https://ehsan.sa/assets/images/logo.svg"
    ], emoji:"💞"
  },
  { id:"chatgpt", name:"ChatGPT",
    srcs:[
      "https://logo.clearbit.com/openai.com",
      "https://upload.wikimedia.org/wikipedia/commons/0/04/ChatGPT_logo.svg"
    ], emoji:"🤖"
  }
];

/* ترتيب المواجهات */
const ORDER = ["tiktok","snapchat","instagram","twitterx","ihsan","chatgpt"];
const KEY = "GAMES_HUB_PICK";

let champion = null; // الفائزة الحالية
let nextIndex = 0;   // يمر على ORDER
function $(id){ return document.getElementById(id); }
function getItem(id){ return ITEMS.find(x=>x.id===id); }

function imgWithFallback(sources, alt, emoji){
  const wrap = document.createElement("div");
  let i = 0;
  const img = document.createElement("img");
  img.className = "img"; img.alt = alt;

  const fb = document.createElement("div");
  fb.className = "fallback"; fb.textContent = emoji || "🖼️"; fb.style.display = "none";

  function tryNext(){
    if (i < sources.length) { img.src = sources[i++]; }
    else { img.style.display="none"; fb.style.display="grid"; }
  }
  img.addEventListener("error", tryNext);
  tryNext();

  wrap.appendChild(img); wrap.appendChild(fb);
  return wrap;
}

function renderPair(){
  const pair = $("pair");
  const bar = $("bar");
  const roundLabel = $("roundLabel");

  // بدء المواجهات
  if (champion === null && nextIndex === 0){
    champion = getItem(ORDER[0]); // TikTok
    nextIndex = 1;                // تواجه Snap
  }

  // نهاية المواجهات
  if (nextIndex >= ORDER.length){
    try { localStorage.setItem(KEY, champion.id); } catch(e){}
    pair.innerHTML = `<div class="muted">🎉 الفائزة النهائية: ${champion.name}. يمكنك المتابعة للعبة 2.</div>`;
    bar.style.width = "100%";
    $("nextBtn").disabled = false;
    roundLabel.textContent = "النهاية";
    return;
  }

  const challenger = getItem(ORDER[nextIndex]);
  pair.innerHTML = ""; // صور تَظهر اثنتين فقط

  [champion, challenger].forEach((item)=>{
    const card = document.createElement("div");
    card.className = "choice";
    card.appendChild(imgWithFallback(item.srcs, item.name, item.emoji));

    const title = document.createElement("div");
    title.className = "title";
    title.textContent = item.name;
    card.appendChild(title);

    card.addEventListener("click", ()=>{
      champion = item;                 // الفائزة تبقى
      nextIndex += 1;                  // تواجه التالية
      const total = ORDER.length - 1;  // عدد المواجهات
      const done  = Math.min(nextIndex, total);
      bar.style.width = Math.floor(done/total*100) + "%";
      roundLabel.textContent = (nextIndex>=ORDER.length) ? "النهاية" : ("الجولة " + (done+1));
      renderPair();
    });

    pair.appendChild(card);
  });

  // تحديث الجولة/التقدم
  const total = ORDER.length - 1;
  const done  = Math.min(nextIndex, total);
  $("bar").style.width = Math.floor(done/total*100) + "%";
  roundLabel.textContent = "الجولة " + (done+1);
}

$("nextBtn").addEventListener("click", ()=> window.location.href = "./step3-game.html?v=3");
renderPair();
</script>
</body>
</html>
